str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,})\\|([0-9])", "\\n\\|\\|\\|([A-Z][a-z]{2,} [A-Z][a-z]{2,})\\|([0-9])")
az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,})\\|([0-9])", "\\n\\|\\|\\|([A-Z][a-z]{2,} [A-Z][a-z]{2,})\\|([0-9])")
assembly_final_scores <- az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,})\\|([0-9])",
"\\n\\|\\|\\|([A-Z][a-z]{2,} [A-Z][a-z]{2,})\\|([0-9])") %>%
read_delim(delim = "|",
col_names = F)
View(assembly_final_scores)
assembly_final_scores <- az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,})\\|([0-9])",
"\\n\\|\\|\\| ([A-Z][a-z]{2,} [A-Z][a-z]{2,})\\|([0-9]) ") %>%
read_delim(delim = "|",
col_names = F)
assembly_final_scores <- az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
# str_replace_all("\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,})\\|([0-9])",
#                 "\\n\\|\\|\\| ([A-Z][a-z]{2,} [A-Z][a-z]{2,})\\|([0-9]) ") %>%
read_delim(delim = "|",
col_names = F)
assembly_final_scores2 <- az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,})\\|([0-9])",
"\\n\\|\\|\\| ([A-Z][a-z]{2,} [A-Z][a-z]{2,})\\|([0-9]) ") %>%
read_delim(delim = "|",
col_names = F)
View(assembly_final_scores2)
View(assembly_final_scores)
assembly_final_scores2 <- az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,})\\|([0-9])",
"\\n\\|\\|([A-Z][a-z]{2,} [A-Z][a-z]{2,})\\|([0-9])") %>%
read_delim(delim = "|",
col_names = F)
assembly_final_scores2 <- az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])",
"\\n\\|\\|([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])") %>%
read_delim(delim = "|",
col_names = F)
?str_replace
assembly_final_scores2 <- az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])",
"\\n\\|\\|") %>%
read_delim(delim = "|",
col_names = F)
assembly_final_scores2 <- az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])",
"\\n\\|\\|\\1") %>%
read_delim(delim = "|",
col_names = F)
az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])",
"\\n\\|\\|\\1")
assembly_final_scores2 <- az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])",
"\\\n\\|\\|\\1") %>%
read_delim(delim = "|",
col_names = F)
assembly_final_scores2 <- az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])",
"\\\n\\|\\|\\|\\1") %>%
read_delim(delim = "|",
col_names = F)
assembly_final_scores2 <- az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])",
"\\\n\\|\\|\\|\\|\\1") %>%
read_delim(delim = "|",
col_names = F)
assembly_final_scores2 <- az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" D ", "  D") %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])",
"\\\n\\|\\|\\|\\|\\1") %>%
read_delim(delim = "|",
col_names = F)
assembly_final_scores2 <- az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" D ", "  D") %>%
str_replace_all("(Committee Average Score: .*%)", "\\1\\\n") %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])",
"\\\n\\|\\|\\|\\|\\1") %>%
read_delim(delim = "|",
col_names = F)
assembly_final_scores2 <- az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" D ", "  D") %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("(Committee Average Score: .*%) ", "\\1\\\n") %>%
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])",
"\\\n\\|\\|\\|\\|\\1") %>%
read_delim(delim = "|",
col_names = F)
assembly_final_scores2 <- az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" D ", "  D") %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("(Committee Average Score: .{4}\\%) ", "\\1\\\n") %>%
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])",
"\\\n\\|\\|\\|\\|\\1") %>%
read_delim(delim = "|",
col_names = F)
assembly_final_scores2 <- az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" D ", "  D") %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("(Committee Average Score\\: .{4}\\%) ", "\\1\\\n") %>%
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])",
"\\\n\\|\\|\\|\\|\\1") %>%
read_delim(delim = "|",
col_names = F)
az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" D ", "  D") %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("(Committee Average Score\\: .{4}\\%) ", "\\1\\\n")
az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" D ", "  D") %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("(Committee Average Score\\: [0-9]{2,}\\.[0-9]\\%) ", "\\1\\\n")
az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" D ", "  D") %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("(Committee Average Score\\: [0-9]{2,}\\.[0-9]\\%)", "\\1\\\n")
az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" D ", "  D") %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("(Committee Average Score\\: [0-9]{2,}\\.[0-9]\\%\\|)", "\\1\\\n")
assembly_final_scores2 <- az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" D ", "  D") %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("(Committee Average Score\\: [0-9]{2,}\\.[0-9]\\%\\|)", "\\1\\\n") %>%
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])",
"\\\n\\|\\|\\|\\|\\1") %>%
read_delim(delim = "|",
col_names = F)
assembly_final_scores2 <- az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" D ", "  D") %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("(Committee Average Score\\: [0-9]{2,}\\.[0-9]\\%\\|)", "\\1\\\n ") %>%
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])",
"\\\n\\|\\|\\|\\|\\1") %>%
read_delim(delim = "|",
col_names = F)
az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" D ", "  D") %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("(Committee Average Score\\: [0-9]{2,}\\.[0-9]\\%\\|)", "\\1\\\n ")
assembly_final_scores2 <- az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" D ", "  D") %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("(Committee Average Score\\: [0-9]{2,}\\.[0-9]\\%\\|)",
"\\1\\|\\|\\|") %>%
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])",
"\\\n\\|\\|\\|\\|\\1") %>%
read_delim(delim = "|",
col_names = F)
assembly_final_scores2 <- az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" D ", "  D") %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("(Committee Average Score\\: [0-9]{2,}\\.[0-9]\\%\\|)|
(House Transportation)",
"\\1\\|\\|\\|") %>%
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])",
"\\\n\\|\\|\\|\\|\\1") %>%
read_delim(delim = "|",
col_names = F)
assembly_final_scores2 <- az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" D ", "  D") %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("(Committee Average Score\\: [0-9]{2,}\\.[0-9]\\%\\|)|(House Transportation)",
"\\1\\|\\|\\|") %>%
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])",
"\\\n\\|\\|\\|\\|\\1") %>%
read_delim(delim = "|",
col_names = F)
assembly_final_scores2 <- az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" D ", "  D") %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("(Committee Average Score\\: [0-9]{2,}\\.[0-9]\\%\\|)|(House Transportation)",
"\\1\\|\\|\\|") %>%
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])",
"\\\n\\|\\|\\|\\|\\1") %>%
str_replace_all("(Party District\\|Score)",
"\\1\\|\\|") %>%
read_delim(delim = "|",
col_names = F)
assembly_final_scores2 <- az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" D ", "  D") %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("(Committee Average Score\\: [0-9]{2,}\\.[0-9]\\%\\|)|(House Transportation)",
"\\1\\|\\|\\|") %>%
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])",
"\\\n\\|\\|\\|\\|\\1") %>%
str_replace_all("(Party District\\|Score)",
"\\1\\|") %>%
read_delim(delim = "|",
col_names = F)
assembly_final_scores2 <- az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" D ", "  D") %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("(Committee Average Score\\: [0-9]{2,}\\.[0-9]\\%\\|)|(House Transportation)",
"\\1\\|\\|\\|") %>%
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])|\\\n([A-Z][a-z]{2,} [A-Z][a-z][A-Z][a-z]{2,}\\|[0-9])",
"\\\n\\|\\|\\|\\|\\1") %>%
str_replace_all("(Party District\\|Score)",
"\\1\\|") %>%
read_delim(delim = "|",
col_names = F)
assembly_final_scores2 <- az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" D ", "  D") %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("(Committee Average Score\\: [0-9]{2,}\\.[0-9]\\%\\|)|(House Transportation)",
"\\1\\|\\|\\|") %>%
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])",
"\\\n\\|\\|\\|\\|\\1") %>%
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z][A-Z][a-z]{2,}\\|[0-9])",
"\\\n\\|\\|\\|\\|\\1") %>%
str_replace_all("(Party District\\|Score)",
"\\1\\|") %>%
read_delim(delim = "|",
col_names = F)
assembly_final_scores2 <- az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" D ", "  D") %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("(Committee Average Score\\: [0-9]{2,}\\.[0-9]\\%\\|)|(House Transportation)",
"\\1\\|\\|\\|") %>%
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])",
"\\\n\\|\\|\\|\\|\\1") %>%
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z][A-Z][a-z]{2,}\\|[0-9])",
"\\\n\\|\\|\\|\\|\\1") %>%
str_replace_all("(Party District\\|Score)",
"\\1\\|") %>%
read_delim(delim = "|",
col_names = F) %>%
distinct(X5, X6) %>%
set_names("name", "final_score")
assembly_final_scores2 <- az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" D ", "  D") %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("(Committee Average Score\\: [0-9]{2,}\\.[0-9]\\%\\|)|(House Transportation)",
"\\1\\|\\|\\|") %>%
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])",
"\\\n\\|\\|\\|\\|\\1") %>%
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z][A-Z][a-z]{2,}\\|[0-9])",
"\\\n\\|\\|\\|\\|\\1") %>%
str_replace_all("(Party District\\|Score)",
"\\1\\|") %>%
read_delim(delim = "|",
col_names = F) %>%
distinct(X5, X6, na.rm = T) %>%
set_names("name", "final_score")
assembly_final_scores2 <- az07_text[14] %>%
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%
str_replace_all(" D ", "  D") %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
str_replace_all("(Committee Average Score\\: [0-9]{2,}\\.[0-9]\\%\\|)|(House Transportation)",
"\\1\\|\\|\\|") %>%
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])",
"\\\n\\|\\|\\|\\|\\1") %>%
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z][A-Z][a-z]{2,}\\|[0-9])",
"\\\n\\|\\|\\|\\|\\1") %>%
str_replace_all("(Party District\\|Score)",
"\\1\\|") %>%
read_delim(delim = "|",
col_names = F) %>%
distinct(X5, X6) %>%
set_names("name", "final_score") %>%
filter(!is.na(name))
## Scrape the voting records from page 15
az_assembly_scores <- az07_text[15] %>%
substr(str_locate(., "\\\n1"), str_locate(., "Arizona")-1) %>%
str_replace_all("\\\001", " U ") %>%
str_replace_all("\\\030", " X ") %>%
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("1\\\n\\|House", "1\\|House") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
read_delim(delim = "|",
col_names = F)
source("~/.active-rstudio-document", echo=TRUE)
## Scrape the names and final scores from page 14
assembly_names_final_scores <- az07_text[14] %>%                                      ## Select page 14
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%   ## Subset to right info - we want the right-most table only so start at that first row
str_replace_all(" D ", "  D") %>%                                                   ## To get the right number of columns, make sure theres two spaces around the party variable in the left table
str_replace_all(" {2,}", "\\|") %>%                                                 ## Replace double spaces with pipes
str_replace_all("\\\n\\|", "\\\n") %>%                                              ## replace pipes after line breaks with just line breaks
str_replace_all("(Committee Average Score\\: [0-9]{2,}\\.[0-9]\\%\\|)|(House Transportation)", ## The rows with table names in the left tables dont have the right number of columns - this fixes it
"\\1\\|\\|\\|") %>%                                                 ## The "\\1" means select the first thing that shows up in parentheses in the pattern portion of the str_replace function
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])",                      ## Here we want to make sure that the names in the right-hand table show up in the right columns
"\\\n\\|\\|\\|\\|\\1") %>%                                          ## We are matching the times that a name following the pattern (Xxxx Xxxx) followed by a number (and not a name followed by a D or an R like in the left tables) gets extra pipes
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z][A-Z][a-z]{2,}\\|[0-9])",            ## We do the same thing again for the names following the pattern (Xxxx XxXxx) like "Nancy McLain"
"\\\n\\|\\|\\|\\|\\1") %>%                                          ## We make sure that there are the right number of pipes to put theses observations in the right columns
str_replace_all("(Party District\\|Score)",                                         ## The rows with table names in the left tables dont have the right number of columns - this fixes it
"\\1\\|") %>%
read_delim(delim = "|",
col_names = F) %>%
set_names("name", "final_score") %>%
filter(!is.na(name))                                                                ## Here we get rid of the NAs to get the list of house members
View(assembly_names_final_scores)
################################################################################
## PURPOSE:
##   - Example scorecard scraping
################################################################################
rm(list = ls())
library(pacman)
p_load(tidyverse, pdftools, rlist, zoo)
setwd("~/Library/CloudStorage/Box-Box/Legislative Scorecards")
################################################################################
## READ IN DATA AND MERGE
################################################################################
################### Example using pdf_text ###################
az07_text <- pdf_text("Data/raw/Arizona/azlcv_scorecard_2007.pdf")
## Scrape the names and final scores from page 14
az_house_names_final_scores <- az07_text[14] %>%                                      ## Select page 14
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%   ## Subset to right info - we want the right-most table only so start at that first row
str_replace_all(" D ", "  D") %>%                                                   ## To get the right number of columns, make sure theres two spaces around the party variable in the left table
str_replace_all(" {2,}", "\\|") %>%                                                 ## Replace double spaces with pipes
str_replace_all("\\\n\\|", "\\\n") %>%                                              ## replace pipes after line breaks with just line breaks
str_replace_all("(Committee Average Score\\: [0-9]{2,}\\.[0-9]\\%\\|)|(House Transportation)", ## The rows with table names in the left tables dont have the right number of columns - this fixes it
"\\1\\|\\|\\|") %>%                                                 ## The "\\1" means select the first thing that shows up in parentheses in the pattern portion of the str_replace function
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])",                      ## Here we want to make sure that the names in the right-hand table show up in the right columns
"\\\n\\|\\|\\|\\|\\1") %>%                                          ## We are matching the times that a name following the pattern (Xxxx Xxxx) followed by a number (and not a name followed by a D or an R like in the left tables) gets extra pipes
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z][A-Z][a-z]{2,}\\|[0-9])",            ## We do the same thing again for the names following the pattern (Xxxx XxXxx) like "Nancy McLain"
"\\\n\\|\\|\\|\\|\\1") %>%                                          ## We make sure that there are the right number of pipes to put theses observations in the right columns
str_replace_all("(Party District\\|Score)",                                         ## The rows with table names in the left tables dont have the right number of columns - this fixes it
"\\1\\|") %>%
read_delim(delim = "|",
col_names = F) %>%
set_names("name", "final_score") %>%
filter(!is.na(name))                                                                ## Here we get rid of the NAs to get the list of house members
## Scrape the names and final scores from page 14
az_house_names_final_scores <- az07_text[14] %>%                                      ## Select page 14
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%   ## Subset to right info - we want the right-most table only so start at that first row
str_replace_all(" D ", "  D") %>%                                                   ## To get the right number of columns, make sure theres two spaces around the party variable in the left table
str_replace_all(" {2,}", "\\|") %>%                                                 ## Replace double spaces with pipes
str_replace_all("\\\n\\|", "\\\n") %>%                                              ## replace pipes after line breaks with just line breaks
str_replace_all("(Committee Average Score\\: [0-9]{2,}\\.[0-9]\\%\\|)|(House Transportation)", ## The rows with table names in the left tables dont have the right number of columns - this fixes it
"\\1\\|\\|\\|") %>%                                                 ## The "\\1" means select the first thing that shows up in parentheses in the pattern portion of the str_replace function
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])",                      ## Here we want to make sure that the names in the right-hand table show up in the right columns
"\\\n\\|\\|\\|\\|\\1") %>%                                          ## We are matching the times that a name following the pattern (Xxxx Xxxx) followed by a number (and not a name followed by a D or an R like in the left tables) gets extra pipes
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z][A-Z][a-z]{2,}\\|[0-9])",            ## We do the same thing again for the names following the pattern (Xxxx XxXxx) like "Nancy McLain"
"\\\n\\|\\|\\|\\|\\1") %>%                                          ## We make sure that there are the right number of pipes to put theses observations in the right columns
str_replace_all("(Party District\\|Score)",                                         ## The rows with table names in the left tables dont have the right number of columns - this fixes it
"\\1\\|") %>%
read_delim(delim = "|",
col_names = F) %>%
set_names("name", "final_score") %>%
filter(!is.na(name))                                                                ## Here we get rid of the NAs to get the list of house members
az07_text[14] %>%                                      ## Select page 14
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%   ## Subset to right info - we want the right-most table only so start at that first row
str_replace_all(" D ", "  D") %>%                                                   ## To get the right number of columns, make sure theres two spaces around the party variable in the left table
str_replace_all(" {2,}", "\\|") %>%                                                 ## Replace double spaces with pipes
str_replace_all("\\\n\\|", "\\\n") %>%                                              ## replace pipes after line breaks with just line breaks
str_replace_all("(Committee Average Score\\: [0-9]{2,}\\.[0-9]\\%\\|)|(House Transportation)", ## The rows with table names in the left tables dont have the right number of columns - this fixes it
"\\1\\|\\|\\|") %>%                                                 ## The "\\1" means select the first thing that shows up in parentheses in the pattern portion of the str_replace function
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])",                      ## Here we want to make sure that the names in the right-hand table show up in the right columns
"\\\n\\|\\|\\|\\|\\1") %>%                                          ## We are matching the times that a name following the pattern (Xxxx Xxxx) followed by a number (and not a name followed by a D or an R like in the left tables) gets extra pipes
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z][A-Z][a-z]{2,}\\|[0-9])",            ## We do the same thing again for the names following the pattern (Xxxx XxXxx) like "Nancy McLain"
"\\\n\\|\\|\\|\\|\\1") %>%                                          ## We make sure that there are the right number of pipes to put theses observations in the right columns
str_replace_all("(Party District\\|Score)",                                         ## The rows with table names in the left tables dont have the right number of columns - this fixes it
"\\1\\|") %>%
read_delim(delim = "|",
col_names = F) %>%
set_names("name", "final_score")
az_house_names_final_scores <- az07_text[14] %>%                                      ## Select page 14
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%   ## Subset to right info - we want the right-most table only so start at that first row
str_replace_all(" D ", "  D") %>%                                                   ## To get the right number of columns, make sure theres two spaces around the party variable in the left table
str_replace_all(" {2,}", "\\|") %>%                                                 ## Replace double spaces with pipes
str_replace_all("\\\n\\|", "\\\n") %>%                                              ## replace pipes after line breaks with just line breaks
str_replace_all("(Committee Average Score\\: [0-9]{2,}\\.[0-9]\\%\\|)|(House Transportation)", ## The rows with table names in the left tables dont have the right number of columns - this fixes it
"\\1\\|\\|\\|") %>%                                                 ## The "\\1" means select the first thing that shows up in parentheses in the pattern portion of the str_replace function
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])",                      ## Here we want to make sure that the names in the right-hand table show up in the right columns
"\\\n\\|\\|\\|\\|\\1") %>%                                          ## We are matching the times that a name following the pattern (Xxxx Xxxx) followed by a number (and not a name followed by a D or an R like in the left tables) gets extra pipes
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z][A-Z][a-z]{2,}\\|[0-9])",            ## We do the same thing again for the names following the pattern (Xxxx XxXxx) like "Nancy McLain"
"\\\n\\|\\|\\|\\|\\1") %>%                                          ## We make sure that there are the right number of pipes to put theses observations in the right columns
str_replace_all("(Party District\\|Score)",                                         ## The rows with table names in the left tables dont have the right number of columns - this fixes it
"\\1\\|")
az_house_names_final_scores
## Scrape the names and final scores from page 14
az_house_names_final_scores <- az07_text[14] %>%                                      ## Select page 14
substr(str_locate(., "FINAL SCORE")+11, str_locate(., "www\\.azlcv\\.org")-1) %>%   ## Subset to right info - we want the right-most table only so start at that first row
str_replace_all(" D ", "  D") %>%                                                   ## To get the right number of columns, make sure theres two spaces around the party variable in the left table
str_replace_all(" {2,}", "\\|") %>%                                                 ## Replace double spaces with pipes
str_replace_all("\\\n\\|", "\\\n") %>%                                              ## replace pipes after line breaks with just line breaks
str_replace_all("(Committee Average Score\\: [0-9]{2,}\\.[0-9]\\%\\|)|(House Transportation)", ## The rows with table names in the left tables dont have the right number of columns - this fixes it
"\\1\\|\\|\\|") %>%                                                 ## The "\\1" means select the first thing that shows up in parentheses in the pattern portion of the str_replace function
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z]{2,}\\|[0-9])",                      ## Here we want to make sure that the names in the right-hand table show up in the right columns
"\\\n\\|\\|\\|\\|\\1") %>%                                          ## We are matching the times that a name following the pattern (Xxxx Xxxx) followed by a number (and not a name followed by a D or an R like in the left tables) gets extra pipes
str_replace_all("\\\n([A-Z][a-z]{2,} [A-Z][a-z][A-Z][a-z]{2,}\\|[0-9])",            ## We do the same thing again for the names following the pattern (Xxxx XxXxx) like "Nancy McLain"
"\\\n\\|\\|\\|\\|\\1") %>%                                          ## We make sure that there are the right number of pipes to put theses observations in the right columns
str_replace_all("(Party District\\|Score)",                                         ## The rows with table names in the left tables dont have the right number of columns - this fixes it
"\\1\\|") %>%
read_delim(delim = "|",
col_names = F) %>%
select(X5, X6) %>%
set_names("name", "final_score") %>%
filter(!is.na(name))                                                                ## Here we get rid of the NAs to get the list of house members
## Scrape the voting records from page 15
az_house_scores <- az07_text[15] %>%
substr(str_locate(., "\\\n1"), str_locate(., "Arizona")-1) %>%
str_replace_all("\\\001", " U ") %>%                                               ## Check marks were read in as "\001"
str_replace_all("\\\030", " X ") %>%                                               ## X's were read in as "\030"
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("1\\\n\\|House", "1\\|House") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
read_delim(delim = "|",
col_names = F)
View(az_house_names_final_scores)
View(az_house_scores)
## Scrape the voting records from page 15
az_house_scores <- az07_text[15] %>%
substr(str_locate(., "\\\n1"), str_locate(., "Arizona")-1) %>%
str_replace_all("\\\001", " U ") %>%                                               ## Check marks were read in as "\001"
str_replace_all("\\\030", " X ") %>%                                               ## X's were read in as "\030"
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("1\\\n\\|House", "1\\|House") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
read_delim(delim = "|",
col_names = F) %>%
select(-X15)
## Scrape the voting records from page 15
az_house_scores <- az07_text[15] %>%
substr(str_locate(., "\\\n1"), str_locate(., "Arizona")-1) %>%
str_replace_all("\\\001", " U ") %>%                                               ## Check marks were read in as "\001"
str_replace_all("\\\030", " X ") %>%                                               ## X's were read in as "\030"
str_replace_all(" {2,}", "\\|") %>%
str_replace_all("1\\\n\\|House", "1\\|House") %>%
str_replace_all("\\\n\\|", "\\\n") %>%
read_delim(delim = "|",
col_names = F) %>%
select(-X15) %>%
filter(X1!="D")
az_house_final_table <- tibble(name = c("weight", "position")) %>%
bind_rows(az_house_names_final_scores) %>%
bind_cols(az_house_scores)
View(az_house_final_table)
