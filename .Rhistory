file.choose()
data <- load("/Users/cefayefang/Downloads/deaths.Rdata")
states <- read_excel( "/Users/cefayefang/Downloads/states.xlsx")
View(deaths)
View(states)
data_wide <- filter(deaths, dtype == "all"& age == "18-20 yrs") %>%
select(states, legal1820, mrate) %>%
pivot_wider(deaths, names_from = year, values_from = c(mrate, legal1820))
data_wide <- filter(deaths, dtype == "all"& age == "18-20 yrs") %>%
select(state, legal1820, mrate) %>%
pivot_wider(deaths, names_from = year, values_from = c(mrate, legal1820))
data_wide <- filter(deaths, dtype == "all"& age == "18-20 yrs") %>%
select(state, mrate, legal1820) %>%
pivot_wider(deaths, names_from = year, values_from = c(mrate, legal1820))
data_wide <- filter(deaths, dtype == "all"& age == "18-20 yrs") %>%
select(state, year, mrate, legal1820) %>%
pivot_wider(deaths, names_from = year, values_from = c(mrate, legal1820))
data_wide <- filter(deaths, dtype == "all"& age == "18-20 yrs") %>%
select(state, year, mrate, legal1820)
View(data_wide)
View(deaths)
data_wide <- filter(deaths, dtype == "all" & age == "18-20 yrs")
View(data_wide)
data_wide <- filter(deaths, dtype == "all" & agegr == "18-20 yrs") %>%
select(state, year, mrate, legal1820) %>%
pivot_wider(deaths, names_from = year, values_from = c(mrate, legal1820))
data_wide <- filter(deaths, dtype == "all" & agegr == "18-20 yrs") %>%
select(state, year, mrate, legal1820) %>%
pivot_wider(names_from = year, values_from = c(mrate, legal1820))
View(data_wide)
data_long <- pivot_longer(data_wide, cols = starts_with("mrate"),
names_to = "year",
names_prefix = "mrate_",
values_to = "mrate")
View(data_long)
states <- read_excel( "/Users/cefayefang/Downloads/states.xlsx") %>%
mutate(FIPS = as.integer(FIPS)) %>%
mutate(FIPS = as.factor(FIPS))
View(states)
?mutate()
?as.integer()
deaths <- left_join(deaths, states, by = c("state" = "FIPS")) %>%
mutate(state = Cstate) %>%
select(-c(Cstate, NAME))
View(deaths)
deaths_diff <- deaths %<%
group_by(state) %>%
filter(agegr == "18-20 yrs" & dtype == "all") %>%
mutate(lag_mrate = lag(mrate, order_by = year)) %>%   #create a new column with last year data
mutate(delta_rate = mrate - lag_mrate)
deaths_diff <- deaths %>%
group_by(state) %>%
filter(agegr == "18-20 yrs" & dtype == "all") %>%
mutate(lag_mrate = lag(mrate, order_by = year)) %>%   #create a new column with last year data
mutate(delta_rate = mrate - lag_mrate)
View(deaths_diff)
deaths_diff <- deaths %>%
group_by(state) %>%
filter(agegr == "18-20 yrs" & dtype == "all") %>%
mutate(lag_mrate = lag(mrate, order_by = year)) %>%   #create a new column with last year data
mutate(delta_rate = mrate - lag_mrate) %>%
ungroup()
?rm()
ggplot(deaths) +
geom_lines(aes(x = year, y = legal1820, color = state))
ggplot(deaths) +
geom_line(aes(x = year, y = legal1820, color = state))
MN_and_AR <- deaths %>%
filter(agegr == "18-20 yrs" & dtype == "all") %>%
filter(state %in% c("MN", "AR"))
ggplot(MN_and_AR) +
geom_line(aes(x=year, y = legal1820, color = state))
?lm()
?factor()
MN_and_AR_reg <- lm(data = MN_and_AR_reg,
mrate ~legal1820 + factor(state) + factor(year))
MN_and_AR_reg <- lm(data = MN_and_AR,
mrate ~legal1820 + factor(state) + factor(year))
summary(MN_and_AR_reg)
unique(deaths$agegr)
library(fixest)
MN_and_AR_reg <- feols(data = MN_and_AR,
mrate = legal1820, fixef = c("year", "state"))
summary(MN_and_AR_reg)
MN_and_AR_reg <- feols(data = MN_and_AR,
mrate ~ legal1820, fixef = c("year", "state"))
summary(MN_and_AR_reg)
controls <- deaths %>%
group_by(state) %>%
select(state, legal1820) %>%
mutate(pure_control = ifelse(max(legal1820) == 0, 1, 0)) %>%
filter(pure_control == 1) %>%
select(state) %>%
distinct() %>%
ungroup()
View(controls)
controls <- controls$state
#treatment states
treated <- unique(deaths$state)
treated <- treated[!(treated %in% controls)]
did_data <- deaths %>%
filter(agegr == "18-20 yrs" & dtype == "all")
View(did_data)
for (i in treated){
reg <- feols(did_data[did_data$state %in% c(i,controls),],
mrate ~ legal1820, fixaf = c("state", "year"))
did_results[did_results$state == i,]$coaf <-reg$coefficients
}
for (i in treated){
reg <- feols(did_data[did_data$state %in% c(i,controls),],
mrate ~ legal1820, fixef = c("state", "year"))
did_results[did_results$state == i,]$coaf <-reg$coefficients
}
did_results <- data.frame(state = treated,
coef = NA)
for (i in treated){
reg <- feols(did_data[did_data$state %in% c(i,controls),],
mrate ~ legal1820, fixef = c("state", "year"))
did_results[did_results$state == i,]$coaf <-reg$coefficients
}
View(did_results)
warnings()
for (i in treated){
reg <- feols(did_data[did_data$state %in% c(i,controls),],
mrate ~ legal1820, fixef = c("state", "year"))
did_results[did_results$state == i,]$coaf <-reg$coefficients[1]
}
for (i in treated){
reg <- feols(did_data[did_data$state %in% c(i,controls),],
mrate ~ legal1820, fixef = c("state", "year"))
did_results[did_results$state == i,]$coef <-reg$coefficients
}
mean(did_results$coef)
didid_data <- deaths %>%
filter(!(agegr == "15-17 yrs")) %>%
filter(dtype == "all") %>%
mutate(legal1829_affected = legal1820*ifelse(agegr == "18-20 yrs", 1, 0))
didid_results <- datafram(state = treated,
coef = NA)
for (i in treated){
reg <- feols(didid_data[didid_data$state %in% c(i,controls),],
mrate ~ legal1820_affected + legal1820, fixef = c("state", "year"))
didid_results[didid_results$state == i,]$coef <-reg$coefficients[1]
}
mean(didid_results$coef)
didid_results <- datafram(state = treated,
coef = NA)
didid_results <- data.frame(state = treated,
coef = NA)
for (i in treated){
reg <- feols(didid_data[didid_data$state %in% c(i,controls),],
mrate ~ legal1820_affected + legal1820, fixef = c("state", "year"))
didid_results[didid_results$state == i,]$coef <-reg$coefficients[1]
}
mean(didid_results$coef)
View(didid_results)
didid_data <- deaths %>%
filter(!(agegr == "15-17 yrs")) %>%
filter(dtype == "all") %>%
mutate(legal1820_affected = legal1820*ifelse(agegr == "18-20 yrs", 1, 0))
for (i in treated){
reg <- feols(didid_data[didid_data$state %in% c(i,controls),],
mrate ~ legal1820_affected + legal1820, fixef = c("state", "year"))
didid_results[didid_results$state == i,]$coef <-reg$coefficients[1]
}
mean(didid_results$coef)
View(didid_data)
placebo_data <- didid_data %>%
filter(state %in% contols)
placebo_results <- data.frame(state = controls,
coef = NA)
for(i in contols){
placebo_data_i <- placebo_data
placebo_data_i[placebo_data_i$state == i &
placebo_data_i$year %in% 1973:1986,]$legal1820 <- 1
placebo_data_i <- mutate(placebo_data_i,
legal1820_affected = legal1820 * ifelse(agegr == "18-20 yrs", 1, 0))
reg <- feols(placebo_data_i,
mrate ~ legal1820_affected + legal1820 + beertaxa, fixef =c("state", "year"))
placebo_results[placebo_results$state == i,]$coef <- reg$coefficients[1]
}
for(i in controls){
placebo_data_i <- placebo_data
placebo_data_i[placebo_data_i$state == i &
placebo_data_i$year %in% 1973:1986,]$legal1820 <- 1
placebo_data_i <- mutate(placebo_data_i,
legal1820_affected = legal1820 * ifelse(agegr == "18-20 yrs", 1, 0))
reg <- feols(placebo_data_i,
mrate ~ legal1820_affected + legal1820 + beertaxa, fixef =c("state", "year"))
placebo_results[placebo_results$state == i,]$coef <- reg$coefficients[1]
}
View(placebo_results)
placebo_data <- didid_data %>%
filter(state %in% contols)
placebo_data <- didid_data %>%
filter(state %in% controls)
placebo_results <- data.frame(state = controls,
coef = NA)
for(i in controls){
placebo_data_i <- placebo_data
placebo_data_i[placebo_data_i$state == i &
placebo_data_i$year %in% 1973:1986,]$legal1820 <- 1
placebo_data_i <- mutate(placebo_data_i,
legal1820_affected = legal1820 * ifelse(agegr == "18-20 yrs", 1, 0))
reg <- feols(placebo_data_i,
mrate ~ legal1820_affected + legal1820 + beertaxa, fixef =c("state", "year"))
placebo_results[placebo_results$state == i,]$coef <- reg$coefficients[1]
}
mean(placebo_results$coef)
library(tidyverse)
library(fixest)
library(readxl)
data <- read_csv("/Users/cefayefang/Desktop/EEP 118/hw/hw 5/rd4_visits.csv")
data <- data %>%
mutate(dummy_MRD = ifelse(district_name == "Minidoka Ranger District", 1,0)) %>%
mutate(dummy_year = ifelse(year >= 2017, 1, 0)) %>%
mutate(MRD_year = dummy_MRD * dummy_year )
library("gghighlight")
data_pre <- filter(data, dummy_year == 0)
ggplot(data_pre) +
geom_line(aes(x=year, y=visits, color = district_name)) +
gghighlight::gghighlight(district_name == "Minidoka Ranger District")
##data_pre %>%
# filter(district_name != "Minidoka Ranger District") %>%
# ggplot(aes(year, visits, color = district_name)) +
# geom_line() +
# geom_line(data = filter(data_pre, district_name == "Minidoka Ranger District"), size = 3) +
# theme(legend.position="bottom")
no_parallel <- data_pre %>%
filter(visits >1500) %>%
select(c(district_name)) %>%
unique()
no_parallel
#so two ranger districts are Carson Ranger District and Salt lake Ranger District
#Remove from 'data_pre'
data_pre_clean <- data_pre[!(data_pre$district_name == "Carson Ranger District" |
data_pre$district_name =="Salt lake Ranger District" ),]
#Remove those two districts in overall data set ('data')
data_clean <- filter(data, district_name != "Carson Ranger District" & data$district_name !="Salt Lake Ranger District" )
reg <- lm(visits ~ dummy_MRD + dummy_year + MRD_year, data = data_clean)
summary(reg)
reg2 <- feols(data_clean,
visits ~ MRD_year, fixef = c("year", "district_name"))
summary(reg2)
data_placebo <- filter(data_clean, district_name != "Minidoka Ranger District")
controls <- unique(data_placebo$district_name)
length(controls)
placebo_results <- data.frame(district_name = controls,
coef = NA)
data_placebo[data_placebo$dummy_year==1,]$dummy_MRD <- 1
data_placebo[data_placebo$dummy_year==1,]$MRD_year <- 1
for(i in controls){
data_placebo_i <- data_placebo
reg <- feols(data_placebo_i,
visits ~ MRD_year, fixef =c("district_name", "year"))
placebo_results[placebo_results$district_name == i,]$coef <- reg$coefficients[1]
}
data_placebo <- filter(data_clean, district_name != "Minidoka Ranger District")
controls <- unique(data_placebo$district_name)
length(controls)
placebo_results <- data.frame(district_name = controls,
coef = NA)
View(data_clean)
View(data_placebo)
for(i in controls){
data_placebo_i <- data_placebo
data_placebo_i[data_placebo_i$district_name == i &
data_placebo_i$year >= 2017,]$dummy_MRD <- 1
reg <- feols(data_placebo_i,
visits ~ MRD_year, fixef =c("district_name", "year"))
placebo_results[placebo_results$district_name == i,]$coef <- reg$coefficients[1]
}
for(i in controls){
data_placebo_i <- data_placebo
data_placebo_i[data_placebo_i$district_name == i &
data_placebo_i$year >= 2017,]$MRD_year <- 1
reg <- feols(data_placebo_i,
visits ~ MRD_year, fixef =c("district_name", "year"))
placebo_results[placebo_results$district_name == i,]$coef <- reg$coefficients[1]
}
View(data_placebo_i)
ggplot(placebo_results)+
geom_histogram(aes( x=coef))
View(placebo_results)
data_placebo_i$MRD_year
placebo_results <- data.frame(district_name = controls,
coef = NA)
for(i in controls){
data_placebo_i <- data_placebo
data_placebo_i$dummy_MRD <- 1
data_placebo_i <- mutate(data_placebo_i, year_MRD = dummy_MRD * dummy_year)
reg <- feols(data_placebo_i,
visits ~ year_MRD, fixef =c("district_name", "year"))
placebo_results[placebo_results$district_name == i,]$coef <- reg$coefficients[1]
}
library(tidyverse)
library(tidyverse)
library(readxl)
library(haven)
library(tidyverse)
library(readxl)
#load() for data in R.data
data <- load("/Users/cefayefang/Downloads/deaths.Rdata")
states <- read_excel( "/Users/cefayefang/Downloads/states.xlsx") %>%
mutate(FIPS = as.integer(FIPS)) %>%
mutate(FIPS = as.factor(FIPS))
##match the class of the data (mutate in the begining)
deaths <- left_join(deaths, states, by = c("state" = "FIPS")) %>%
mutate(state = Cstate) %>%
select(-c(Cstate, NAME))
View(deaths)
#states set 21 legal age all the time
controls <- deaths %>%
group_by(state) %>%
select(state, legal1820) %>%
mutate(pure_control = ifelse(max(legal1820) == 0, 1, 0)) %>%
filter(pure_control == 1) %>%
select(state) %>%
distinct() %>%
ungroup()
controls <- controls$state
treated <- unique(deaths$state)
treated <- treated[!(treated %in% controls)]
source("~/Desktop/EEP 118/section/section5.R", echo=TRUE)
didid_data <- deaths %>%
filter(!(agegr == "15-17 yrs")) %>%
filter(dtype == "all") %>%
mutate(legal1820_affected = legal1820*ifelse(agegr == "18-20 yrs", 1, 0))
View(didid_data)
library(tidyverse)
library(fixest)
library(readxl)
data <- read_csv("/Users/cefayefang/Desktop/EEP 118/hw/hw 5/rd4_visits.csv")
data <- data %>%
mutate(dummy_MRD = ifelse(district_name == "Minidoka Ranger District", 1,0)) %>%
mutate(dummy_year = ifelse(year >= 2017, 1, 0)) %>%
mutate(MRD_year = dummy_MRD * dummy_year )
data <- data %>%
mutate(dummy_MRD = ifelse(district_name == "Minidoka Ranger District", 1,0)) %>%
mutate(dummy_year = ifelse(year >= 2017, 1, 0)) %>%
mutate(MRD_year = dummy_MRD * dummy_year )
library("gghighlight")
data_pre <- filter(data, dummy_year == 0)
ggplot(data_pre) +
geom_line(aes(x=year, y=visits, color = district_name)) +
gghighlight::gghighlight(district_name == "Minidoka Ranger District")
##data_pre %>%
# filter(district_name != "Minidoka Ranger District") %>%
# ggplot(aes(year, visits, color = district_name)) +
# geom_line() +
# geom_line(data = filter(data_pre, district_name == "Minidoka Ranger District"), size = 3) +
# theme(legend.position="bottom")
no_parallel <- data_pre %>%
filter(visits >1500) %>%
select(c(district_name)) %>%
unique()
no_parallel
#so two ranger districts are Carson Ranger District and Salt lake Ranger District
#Remove from 'data_pre'
data_pre_clean <- data_pre[!(data_pre$district_name == "Carson Ranger District" |
data_pre$district_name =="Salt lake Ranger District" ),]
#Remove those two districts in overall data set ('data')
data_clean <- filter(data, district_name != "Carson Ranger District" & data$district_name !="Salt Lake Ranger District" )
reg <- lm(visits ~ dummy_MRD + dummy_year + MRD_year, data = data_clean)
summary(reg)
reg2 <- feols(data_clean,
visits ~ MRD_year, fixef = c("year", "district_name"))
summary(reg2)
data_placebo <- filter(data_clean, district_name != "Minidoka Ranger District")
controls <- unique(data_placebo$district_name)
length(controls)
placebo_results <- data.frame(district_name = controls,
coef = NA)
for(i in controls){
data_placebo_i <- data_placebo
data_placebo_i[data_placebo_i$district_name == i &
data_placebo_i$year >= 2017,]$MRD_year <- 1
reg <- feols(data_placebo_i,
visits ~ MRD_year, fixef =c("district_name", "year"))
placebo_results[placebo_results$district_name == i,]$coef <- reg$coefficients[1]
}
ggplot(placebo_results)+
geom_histogram(aes( x=coef))
#The parameter estimate is smaller than
View(data)
library(tidyverse)
library(haven)
file.choose()
data <- read_dta( "/Users/cefayefang/Downloads/WAGE2.DTA")
View(data)
naive <- lm(wage ~ educ, data=data)
summary(naive)
names(data)
naive1 <- lm(wage ~ educ, data=data)
summary(naive1)
naive <- lm(wage ~ educ + age + black, data=data)
summary(naive)
first_stage <- lm(educ ~ meduc + feduc + age + black, data = data)
summary(first_stage)
data$fittededuc <- first_stage$fitted.values
first_stage$fitted.values
View(first_stage)
data <- data[-first_stage$na.action,]  #exclude missing variables for matching
data$fittededuc <- first_stage$fitted.values
second_stage <- lm(wage ~ fittededuc + age + black, data = data)
summary(second_stage)
#do 2sls using fixed
library(fixest)
tsls <- feols(data = data,
fml = wage ~ age + black | educ ~ meduc + feduc))
tsls <- feols(data = data,
fml = wage ~ age + black | educ ~ meduc + feduc)
summary(tsls)
data$firststageresidual <- first_stage$residuals
endogeneity_test <- lm(data = data,
wage ~ educ + age + black + firststageresidual)
summary(endogeneity_test)
summary(overidentifying_test)
data$secondstageresidual <- tsls$residuals
overidentifying_test <- lm(data = data,
secondstageresidual ~ meduc + feduc + age + black)
summary(overidentifying_test)
dim(data)
dim(data)
test_statistics <- 722 * 1.974e-06
critical <- qchisq(0.95, df = 1)
test_statistics < critical
test_statistics
critical
library(readxl)
library(lubridate)
install.packages("lubridate")
install.packages("lubridate")
library(readxl)
library(lubridate)
file.choose()
sbux <- read_csv("/Users/cefayefang/Downloads/sbux.csv")
View(sbux)
sbux <- read_csv("/Users/cefayefang/Downloads/sbux.csv") %>%
rename(close = "Close/Last") %>%
select(Date, Close) %>%
mutate(closa = substring(Close, 2)) %>%
mutate(Date = mdy(Date),
Close = as.number(Close))
sbux <- read_csv("/Users/cefayefang/Downloads/sbux.csv") %>%
rename(Close = "Close/Last") %>%
select(Date, Close) %>%
mutate(closa = substring(Close, 2)) %>%
mutate(Date = mdy(Date),
Close = as.number(Close))
sbux <- read_csv("/Users/cefayefang/Downloads/sbux.csv") %>%
rename(Close = "Close/Last") %>%
select(Date, Close) %>%
mutate(closa = substring(Close, 2)) %>%
mutate(Date = mdy(Date),
Close = as.numberic(Close))
sbux <- read_csv("/Users/cefayefang/Downloads/sbux.csv") %>%
rename(Close = "Close/Last") %>%
select(Date, Close) %>%
mutate(closa = substring(Close, 2)) %>%
mutate(Date = mdy(Date),
Close = as.numeric(Close))
sbux <- read_csv("/Users/cefayefang/Downloads/sbux.csv") %>%
rename(Close = "Close/Last") %>%
select(Date, Close) %>%
mutate(Close = substring(Close, 2)) %>%
mutate(Date = mdy(Date),
Close = as.numeric(Close))
plot(x = sbux$Date, y = sbux$Close, type = "1")
plot(x = sbux$Date, y = sbux$Close)
?type
plot(x = sbux$Date, y = sbux$Close, type = "l")
?substring()
sbux <- mutate(sbux,
lagClose = lag(Close, order_by = Date)) %>%
mutate(dclose = Close -lagClose) %>%
mutate(monday = ifelse(wday(Date) == 2,1,0),
friday = ifelse(wday(Date) == 6,1,0))
ts <- lm(data = sbux, dClose ~ monday + friday)
sbux <- mutate(sbux,
lagClose = lag(Close, order_by = Date)) %>%
mutate(dclose = Close -lagClose) %>%
mutate(monday = ifelse(wday(Date) == 2,1,0),
friday = ifelse(wday(Date) == 6,1,0))
ts <- lm(data = sbux, dClose ~ monday + friday)
sbux <- mutate(sbux,
lagClose = lag(Close, order_by = Date)) %>%
mutate(dClose = Close -lagClose) %>%
mutate(monday = ifelse(wday(Date) == 2,1,0),
friday = ifelse(wday(Date) == 6,1,0))
ts <- lm(data = sbux, dClose ~ monday + friday)
summary(ts)
sbux <- mutate(sbux,
lagClose = lag(Close, order_by = Date)) %>%
mutate(dClose = Close -lagClose) %>%
mutate(monday = ifelse(wday(Date) == 2,1,0),
friday = ifelse(wday(Date) == 6,1,0)) %>%
select(-dclose)
tinytex::install_tinytex()
?log
file.choose()
setwd("~/Library/CloudStorage/Box-Box/Legislative Scorecards")
install.packages(pacman)
install.packages('pacman')
library(pacman)
!ls
~ls
getwd()
rm(list = ls())
library(pacman)
p_load(tidyverse, pdftools, rlist, zoo)
ny_06_text <- pdf_text("Data/raw/New York/votersguide_2006.pdf")
